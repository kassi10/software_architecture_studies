Acho que, para a arquitetura, é sempre bom a gente lembrar alguns conceitos que a gente não pode esquecer. A gente tem que pensar em desacoplamento da arquitetura. Facilmente a gente constrói contextos que se conectam, eles vão se conectar porque, normalmente, um negócio precisa de várias peças para sobreviver, mas criar desacoplamento é extremamente importante. E uma coisa que eu estava falando agora com o Wesley, que acho que é legal a gente pensar, é que a gente fala muito do desacoplamento, para quem já faz sistema há bastante tempo, na hora de usar a plataforma ou na hora de ter que fazer uma mudança. Por exemplo, chegou um projeto novo, a peça que eu estou mexendo não pode estar acoplada com a peça da minha squad do lado, com o contexto do lado, etc. Mas é bom você pensar também em desacoplamento em ambientes de teste. Às vezes a gente cria tudo bem desacoplado numa visão de arquitetura, mas cria um acoplamento na hora de testar, o que é bem complicado. Porque, depois, no dia a dia, você vai ter contextos diferentes, com equipes diferentes, prioridades diferentes, e pode acontecer. Não acontece nunca, mas toda hora está acontecendo. E as coisas não vão se falar, você vai depender de uma da outra para ter o time de marketing, para conseguir lançar coisas novas. Então, é bacana você sempre pensar na forma de deixar tudo o mais desacoplado possível.

E aqui também um outro ponto: o quanto o seu acoplamento pode gerar de impacto no ambiente todo. Quando você tem vários times para fazer um sistema gigante, as matérias de Circuit Breaker, de pensar em como a minha aplicação não vai roubar todas as demais, de pensar em como eu posso usar um Bulkhead, de uma ideia de como eu impacto, mas impacto menor o problema todo, ou deixo a minha aplicação mais setorizada em várias máquinas para a gente não derrubar tudo, diminuir carga quando necessário. Quando você está falando de um sistema extremamente complexo, com várias interligações, por mais que você deixe os microsserviços autocontidos, você tem que pensar em como o seu microsserviço autocontido pode ter impacto sobre o outro.

Vou dar um exemplo: vou lá e vou fazer um microsserviço de recebimento de pagamento via Pix. Ou de compra. Vamos fazer um marketplace, para não falar só de banco. Estou lá fazendo um serviço de marketplace. Vou fazer um recebimento de vários pedidos de compra. Chegou o momento e engargalou. Os caras estão fazendo um monte de pedido, e eu preciso processar o pagamento no meu contexto de pagamento aqui dentro de casa. Beleza, você recebeu vários pedidos e fala: "estou com o sistema de pagamento fora e vou represar esses caras aqui para depois processar e depois mandar uma lista de e-mail para todo mundo falando: ou um SMS ou o WhatsApp, falando: 'S seu pagamento foi aceito e o seu pedido vai chegar.' Então, tem um cara aqui, uma peça que vai fazer o pedido, tem uma peça de pagamento e tem uma mensageria que vai devolver falando: deu certo ou não deu certo quando isso cai.

Então, a zero de jogo, a sua resposta vai ser síncrona. Por mais que você pense, você pode até pensar no sistema síncrono, mas você vai responder no mesmo momento para o front-end, para o aplicativo. Recebeu o pedido, pagamento está de pé, recebeu o pagamento, toma, deu tudo certo. O pagamento caiu, recebeu o pedido, pagamento caiu, respondo na tela: “Aguarda um pouquinho que daqui a pouco no seu e-mail você vai receber a confirmação." Bacana, fui represando aqui, represei, represei, represei. Na hora que voltou o sistema de pagamento, possivelmente esse cara de pagamento se preparou para receber uma rajada, porque você segurou um monte de coisa ali, ou pode ser que ele tenha segurado o lado dele.

Primeiro, essa conversa tem que ser extremamente alinhada para você também não segurar os processamentos aqui. Ele segurar lá parece besteira, mas é bom vocês fecharem essa perna. Quem vai segurar aqui a requisição para fazer os processamentos? Vai ser o time de pagamentos?  Quando você vê que tudo isso começou a sair para conseguir mandar de volta o e-mail ou o WhatsApp, ou etc., mensageria para o cliente, essa peça que você pensou aqui, que pode ter sido outra pessoa do seu time ou outro time que é só de mensageria, está preparada para receber uma muitas de requisição? Às vezes, ele estava preparado, ele fez um serviço de mensageria ali para atender compras pequenas, um marketplace que está vendendo bens de consumo. “Ah, mas estou tendo uma campanha agora que estou vendendo ingresso e estou usando esse mesmo sistema, ingresso para o Detal, estou vendendo ingresso para o Lollapalooza.” Vai vir uma rajada de requisição e essa mensageria vai aguentar mandar depois ou ela vai capotar? É legal pensar em como essas coisas se falam. Dentro do desacoplamento, você também pensar em como os sistemas desacoplados vão ter resiliência. Eu vou falar de resiliência. Eu vou falar de resiliência abaixo, mas é interessante a gente pensar no desacoplamento para pensar na resiliência ao mesmo tempo, quando você está gerando contextos muito separados.

 

Pensar também que o desacoplamento, quando a gente fala disso, também não gera gargalo. Se você tiver contextos que não são autocontidos, que não conseguem se resolver, não têm autonomia, possivelmente no dia a dia você vai ter esses pedidos cruzados. "Olha, eu preciso fazer isso, mas eu preciso desse outro time, que também faz, que precisa desse outro time, que também faz." E, para fazer qualquer coisinha pequena, você está gerando times que não têm autonomia, e deve virar um gargalo, porque os contextos estão se cruzando, cada um quer fazer uma coisa e todo mundo se odiando ali no dia a dia, porque ninguém consegue.

Cuidado com uma lei também que tem, que é a Lei de Conway: o quanto a gente está pegando o nosso sistema e copiando o que tem na nossa organização. Ou seja, tem o time do Wesley, que está aqui com um contexto, o time do Nathan está com outro contexto, então vamos separar, porque o time do Wesley e o time do Nathan não, vamos separar os contextos. Invariavelmente vai acontecer de você copiar a sua topologia de empresa, o seu sistema tem algum impacto dado a topologia, isso é normal, é uma lei que pega mesmo no dia a dia, vai acontecer. Mas como você faz para diminuir ao máximo isso e não ficar enviesado pelos nomes das cadeiras e não pelos contextos do seu domínio de negócio?

Resiliência. Acho que a gente tem que pensar bastante nisso quando está falando de uma arquitetura para fazer uma mudança desse tamanho. É você abusar de perguntar: "Mas e se?"  E se o sistema de pagamento cair? E se o sistema de compra de ingressos cair? E se o sistema de tracking de mercadoria cair? O que vai acontecer? E se aumentar o número de requisições? Se cair o número de requisições? Baixou muito, ficou quase zero. O que acontece? Será que eu preciso de um alerta porque pode ter alguma coisa fora? Eu tinha mil requisições por hora e agora está tendo zero? Tem alguma coisa esquisita aqui. Então, pensar nos "e se". Sempre pensar nisso para a resiliência da sua aplicação.

A gente costuma não fazer isso. No dia a dia, a gente pensa muito no caminho de como as coisas funcionam e pensa pouco no como elas vão acontecer se não funcionarem. Se tudo der errado, o que vai acontecer? Aprende com quem já fez. Se tem um sistema lá, possivelmente ele já passou por poucas e boas. Quando você implementa um sistema, você começa a aprender. Isso a gente esquece também. Um sistema de 50 anos, ele tem 50 anos de história, de aprendizado, de código novo sendo colocado, de ideias diferentes, de pessoas que passaram e aperfeiçoaram esse código. Ele está na melhor linguagem? Pode não estar, ele pode estar acoplado, pode ter um monte de coisa, mas ele já passou por muito conhecimento. Entenda com quem já passou por isso, entenda com o sistema que você já tem, para você ter a melhor conversa, a melhor informação para tomadas de decisão ali, para montar uma resiliência.

Outra coisa: você vai precisar ter conversas duras sobre as prioridades e sobre o que eu conversei aqui com o Wesley, de: "Isso aqui eu vou ter que construir, depois vou ter que jogar fora, mas vou ter que fazer isso do jeito certo daqui a uma semana. A gente vai construir para entregar, ficar uma semana testando, jogar fora e fazer." Às vezes você vai precisar disso. E para fazer isso, é muito importante você ter claro o que você vai entregar e qual vai ser a prioridade disso e, para a resiliência, você pensar em qual a prioridade de execução de cada coisa.

Eu até criei uma lei, porque eu nunca vou ter uma lei no meu nome porque eu não sou nenhum gênio da matemática ou da física, mas eu criei uma lei no meu nome, a Lei dos Freitas. Coloquei até o meu nome em português, para dar bastante peso de autoridade aqui. Você tem que tratar o seu sistema como se fosse um corpo humano. Você tem que definir as prioridades das funções. Sabe por quê? “Ah, é importante a gente ter a nossa visão? É importante. É importante a gente ter o nosso movimento do braço?” É importante, mas é mais importante o nosso coração bater. É mais importante a gente ter um cérebro que está funcionando. Então, quando a gente tem algum problema, a gente vai atacar primeiro os sistemas centrais e deixar eles funcionando. Seu sistema tem que ser a mesma coisa.

É importante eu ter um meio de venda, por exemplo, de ticket do Lollapalooza no meu app? É importante. É importante eu ter esse mesmo cara conseguindo ser vendido por uma agência no shopping? Uma loja no shopping? É importante. Se começar a dar problema, quem que eu derrubo? Derrubo a loja ou derrubo o sistema online? Derrubo o meu app? Eu tenho que tomar essa decisão. Se eu tiver muito problema acontecendo no core do sistema, o que eu topo perder? O que eu perco primeiro antes de sair derrubando tudo? Acho que é importante ter essas conversas duras e pensar que o nosso sistema é assim, como se fosse um sistema vivo, um sistema do corpo humano. Você tem que definir prioridades e aceitar perder algumas em determinado momento. Dificilmente quando você for falar com alguém, com o cliente, o seu stakeholder ou alguém de produto, a gente entende isso como uma coisa boa, mas no dia a dia é bom, porque quando tem problema, você sabe aonde vai perder primeiro e já constrói seu sistema com a resiliência orientada a isso.