Bom, pessoal, no vídeo anterior a gente falou aqui sobre autenticação. O servidor de autenticação gera um JWT, e aqui a nossa API Gateway é capaz de validar esse JWT para que ela mande as requisições para os microsserviços. Ela consegue validar esse JWT porque ela tem uma chave pública, e se essa chave pública conseguir validar, falar que o token veio do nosso servidor de identidade, está tudo “ok” e a gente está tranquilo.

Qual é o grande problema disso? Vamos imaginar que na hora que o servidor de identidade gerar o token, ele vai ter que gerar também uma expiração, ou seja, por quanto tempo esse token for válido. Vamos imaginar que ele gera esse token para uma hora de tempo, ou seja, a data de expiração para esse token. Esse token começou a ser utilizado durante um minuto, passou um minuto, e de repente a gente fala, “olha, eu quero invalidar a autenticação desse usuário”. Como a nossa API Gateway não está a todo momento batendo no servidor de autenticação, durante essa uma hora que esse usuário mandar o token para a API Gateway, ela vai validar esse token e falar que ele está “ok”. Você entende qual é o problema? Então, se você precisa cancelar o login do usuário ali, o maior problema que você vai ter é que durante o tempo de expiração, enquanto essa expiração não acabar, o usuário ainda vai poder acessar o sistema. Nesse momento, você precisa ter  estratégias de verificação para saber quanto tempo você vai utilizar de expiração para cada token.

Vamos imaginar que a gente coloque a expiração em vez de uma hora por cinco minutos. A gente garante que durante cinco minutos o usuário vai sempre acessar, mesmo que a gente cancele o login dele. Passou cinco minutos, esse token é inválido, e ele vai ter que utilizar um refresh token, ou seja, uma nova solicitação de um token para ele pegar um outro token para validar por mais cinco minutos. E, com esse refresh token, ele vai ter que bater aqui no nosso serviço de autenticação. Então, quanto maior for o tempo de expiração do token, maior vai ser o tempo que você não vai ter controle que o usuário vai poder acessar a sua aplicação. Porém, quanto maior esse tempo, menor vai ser a carga no servidor de autenticação. Quanto menor o tempo, você consegue ter um controle maior, porque o token do cara vai expirar mais rapidamente, porém, a carga no servidor de autenticação vai ser maior. Então, é nesse momento que você vai ter que fazer essa verificação. Bom, temos aqui alguns outros casos em relação a essa parte de validação. Vamos falar sobre isso aqui no próximo vídeo.

