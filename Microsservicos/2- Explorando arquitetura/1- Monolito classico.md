Bom, pessoal, o seguinte, no nosso capítulo anterior, o que a gente fez? A gente falou um pouco sobre arquitetura baseada em microsserviços. Falamos um pouco sobre monólitos e agora, sabe aquela história de: “desenha que fica um pouco mais claro para todo mundo?” Então, eu quero trazer aqui alguns desenhos somente para que você consiga internalizar tudo o que a gente já falou.

Então, o primeiro ponto aqui que nós vamos, entre aspas, desenhar é sobre um monólito clássico que acaba, sim, conseguindo escalar. Então, vamos fazer… (deixa eu colocar esse cara aqui somente para tentar deixar o mais claro possível aqui para você. Então, vamos colocar esse cara aqui). E aqui está o nosso monólito  clássico e escalável. E o porquê eu estou dizendo isso? Porque toda vez que a gente está falando em um monólito  clássico, normalmente a gente está falando em um sistema. Então, esse cara aqui é o sistema e dentro do sistema nós temos o quê? Diversos componentes. A gente tem módulos dentro do mesmo sistema. A gente tem as classes dentro do mesmo sistema, ou seja, a gente tem aquilo que faz com que o nosso sistema funcione. Normalmente, a gente também tem um banco de dados ou pode ter até mais bancos de dados, e é uma questão apenas de ajuste mesmo, depende do que o sistema faz. Normalmente, a gente também pode ter ali um banco de dados de cache. E também, o que acontece, conforme o nosso sistema for crescendo, a nossa demanda de acesso for crescendo, o que vai acontecer? A gente coloca um balancer, um API Gateway aqui na frente, não importa. E a gente começa a crescer o quê? Horizontalmente. Ou seja, ora a requisição vai cair aqui, ora a requisição vai cair aqui. Então, isso é um monólito  clássico, vamos dizer assim.

Agora, lembrando um pouco aqui para você, nós temos dois formatos de escala, de crescimento do nosso sistema. Um é o vertical, que nesse caso aqui a gente aumenta o nosso hardware para ele aguentar mais requisições. E o outro é a horizontal, que a gente coloca mais máquinas. Na maioria das vezes, o caso mais sustentável vai ser crescer horizontalmente, porque vai chegar num momento que você não vai ter mais máquina para suprir, e o valor da máquina que você vai pagar aqui vai ser mais alto do que você ter diversas pequenas máquinas. Então, isso é um ponto importante aqui para você.

Agora, lembrando que nós temos alguns pontos que você tem que levar sempre em consideração na hora de escalar qualquer tipo de sistema independente, se ele é um microsserviço ou se ele é um monólito . Quais são esses pontos que você tem que pensar? (Eu vou até colocar aqui do lado como observação) O disco tem que ser efêmero (Deixa eu até colocar aqui como um verdinho para ficar claro). O que significa que o disco tem que ser efêmero? Seja que todos os dados que são armazenados em disco no seu sistema, por exemplo, um upload de um arquivo. Aqui um upload de arquivo, por exemplo, o que acontece? Quando essa máquina for removida, esse dado também vai ser removido. Então, na hora que você for, por exemplo, fazer um upload, você não vai fazer o upload no próprio disco da sua aplicação, porque você tem que pensar que essa aplicação pode morrer a qualquer momento. Você pode subir no Cloud Storage, no S3 da vida ou em algum outro local onde você guarda arquivos. É um local persistente realmente de dados. Se você começar a gravar arquivos específicos aqui, o que vai acontecer quando o usuário acessar aqui o arquivo vai estar aqui? Quando o cara acessar aqui o arquivo não vai estar aqui e quando esse cara morrer você perde completamente os arquivos.

Outro ponto importante que você vai ter que também levar em conta, vai ser o seguinte, os logs também devem ser… os logs devem ser, como eu posso colocar? Os logs devem ser upload dados. O que isso significa? Significa que tudo que você tiver de log ali na sua aplicação…os logs também não vão poder ficar armazenados nessa máquina, porque se a máquina for apagada você vai perder os logs de tudo que aconteceu. Esse também é um outro ponto importante.

Outro ponto importante aqui também, as sessões dos usuários, não podem ficar armazenadas em disco. Sessões usuários versus disco, porque se ficar armazenado em disco, uma hora o usuário vai estar autenticado, outra hora ele não vai ser autenticado, quando essa máquina morrer perde a sessão e vai ficar uma coisa muito maluca ali. A lógica aqui é a seguinte, todas as vezes que você criar qualquer tipo de sistema, e esse sistema pode ser destruído, criado novamente, o software morrer, e você recria ou você escala, começa a criar mais máquinas. A regra é a seguinte: o seu software tem que estar pronto para ser destruído e ser recriado novamente, sem gerar nenhum efeito colateral de perda de dados. Se o comportamento da sua aplicação mudar pelo fato… se o comportamento da sua aplicação mudar pelo fato de você destruir a aplicação e subir ela de novo, significa que você está armazenando o que? Estado. Esse aqui é o principal ponto. Não armazenar estado. Toda vez que você armazena estado, o que vai acontecer? Você vai poder perder a aplicação. Então, siga essas regras.

Isso aqui também. Existe um documento bem interessante que eu vou deixar para vocês, que é o 12 Factor App, que foi criado pela galera do Heroku, onde é falado muito sobre, vamos dizer assim, essas regrinhas para que você consiga sim criar de forma sustentável sistemas que vão poder escalar, desescalar, sem nenhuma perda de dados. De uma forma ou de outra, isso aqui é independente de você está trabalhando com microsserviços ou sistema monolítico. Mas de forma geral, toda vez que a gente vai trabalhar com sistemas clássicos monolíticos, normalmente você vai ter um comportamento, pelo menos um pouco parecido com isso que eu estou mostrando agora.

Agora, tem alguma coisa de errado em fazer esse tipo de abordagem? Absolutamente não! Não tem nada de errado. O que você vai perceber é que conforme você for trazendo muito acesso, a gente tende a ter um gargalo aqui, porque aqui a gente está conseguindo escalar. Então, normalmente o gargalo começa a ficar maior aqui no banco de dados. Hoje em dia, a gente tem tecnologias muito bacanas de bancos de dados, que conseguem escalar muito bem também. Então, até você ter um gargalo muito forte no banco de dados, pode ser que demore, mas o custo também pode ficar bem elevado. A mesma coisa aqui no cache. Então, está aqui uma ideia de um sistema monolítico clássico, que normalmente você vai conseguir escalar. Até o nosso próximo vídeo.